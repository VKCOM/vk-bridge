<div>
  <a href="https://github.com/VKCOM">
    <svg width="134px" height="24px" viewBox="0 0 134 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <defs>
        <linearGradient x1="0%" y1="48.3636366%" x2="100%" y2="51.6363634%" id="linearGradient-1">
            <stop stop-color="#5C6AAB" offset="0%"></stop>
            <stop stop-color="#152367" offset="100%"></stop>
        </linearGradient>
    </defs>
    <g id="Github-Headers" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Artboard" transform="translate(-277.000000, -812.000000)">
            <g id="vk_mini_apps_logo" transform="translate(277.000000, 812.000000)">
                <rect id="Rectangle" x="0" y="0" width="134" height="24"></rect>
                <path d="M15.68,0 C22.4,0 24,1.6 24,8.32 L24,15.68 C24,22.4 22.4,24 15.68,24 L8.32,24 C1.6,24 4.40536496e-13,22.4 4.40536496e-13,15.68 L4.40536496e-13,8.32 C4.40536496e-13,1.6 1.6,0 8.32,0 L15.68,0 Z M102.0745,6.1625 C105.1295,6.1625 107.785,8.818 107.785,12.39 C107.785,15.9855 105.1295,18.641 102.0745,18.641 C100.077,18.641 98.8785,17.4425 98.8785,17.4425 L98.8785,17.4425 L98.8785,22.7535 L95.8235,22.7535 L95.8235,6.28 L98.0795,6.28 L98.62,7.4785 C98.62,7.4785 99.936,6.1625 102.0745,6.1625 Z M116.042,6.1625 C119.097,6.1625 121.7525,8.818 121.7525,12.39 C121.7525,15.9855 119.097,18.641 116.042,18.641 C114.0445,18.641 112.846,17.4425 112.846,17.4425 L112.846,17.4425 L112.846,22.7535 L109.791,22.7535 L109.791,6.28 L112.047,6.28 L112.5875,7.4785 C112.5875,7.4785 113.9035,6.1625 116.042,6.1625 Z M88.5065,6.1625 C91.2795,6.1625 93.277,8.1365 93.277,10.933 L93.277,10.933 L93.277,18.5 L91.021,18.5 L90.504,17.3015 C90.504,17.3015 89.1645,18.641 87.0495,18.641 C84.394,18.641 82.937,17.184 82.937,15.1865 C82.937,12.7895 84.6525,11.074 90.222,11.074 C90.222,9.7345 89.423,8.9355 88.248,8.9355 C86.65,8.9355 86.368,10.275 86.368,10.275 L86.368,10.275 L83.313,10.275 C83.595,8.019 85.4515,6.1625 88.5065,6.1625 Z M127.7535,6.1625 C130.6675,6.1625 132.2655,7.737 132.524,9.8755 L132.524,9.8755 L129.61,9.8755 C129.469,9.335 128.811,8.677 127.871,8.677 C126.9545,8.677 126.414,9.2175 126.414,9.8755 C126.414,11.591 132.665,10.5335 132.665,14.9045 C132.665,16.902 130.926,18.641 128.153,18.641 C124.957,18.641 123.359,17.043 123.1005,14.646 L123.1005,14.646 L126.0145,14.646 C126.1555,15.445 126.8135,16.103 127.871,16.103 C128.9285,16.103 129.61,15.445 129.61,14.787 C129.61,13.048 123.359,14.129 123.359,9.8755 C123.359,7.878 125.098,6.1625 127.7535,6.1625 Z M75.071,6.28 L75.071,18.5 L72.016,18.5 L72.016,6.28 L75.071,6.28 Z M64.5815,6.1625 C67.4955,6.1625 69.493,8.1365 69.493,11.3325 L69.493,11.3325 L69.493,18.5 L66.438,18.5 L66.438,11.732 C66.438,10.134 65.3805,9.0765 63.9,9.0765 C62.443,9.0765 61.3855,10.134 61.3855,11.732 L61.3855,11.732 L61.3855,18.5 L58.3305,18.5 L58.3305,6.28 L60.5865,6.28 L61.127,7.4785 C61.127,7.4785 62.584,6.1625 64.5815,6.1625 Z M55.6665,6.28 L55.6665,18.5 L52.6115,18.5 L52.6115,6.28 L55.6665,6.28 Z M45.7175,6.1625 C48.373,6.1625 50.0885,7.878 50.0885,11.1915 L50.0885,11.1915 L50.0885,18.5 L47.0335,18.5 L47.0335,11.4735 C47.0335,9.993 46.0935,9.0765 45.036,9.0765 C43.9785,9.0765 43.062,9.993 43.062,11.4735 L43.062,11.4735 L43.062,18.5 L40.007,18.5 L40.007,11.4735 C40.007,9.993 39.067,9.0765 38.0095,9.0765 C36.952,9.0765 36.012,9.993 36.012,11.4735 L36.012,11.4735 L36.012,18.5 L32.957,18.5 L32.957,6.28 L35.213,6.28 L35.7535,7.4785 C35.7535,7.4785 36.952,6.1625 38.6675,6.1625 C41.182,6.1625 42.122,7.737 42.122,7.737 C42.122,7.737 43.579,6.1625 45.7175,6.1625 Z M6.50003052,7.5 L4.75003052,7.5 C4.25003052,7.5 4.15002441,7.73537544 4.15002441,7.99492431 C4.15002441,8.45843972 4.74331426,10.757407 6.91247624,13.7979557 C8.35857394,15.8744085 10.3960306,17 12.2500305,17 C13.3624181,17 13.5000305,16.75 13.5000305,16.3193758 L13.5000305,14.75 C13.5000305,14.25 13.6054116,14.1502139 13.9576697,14.1502139 C14.2172186,14.1502139 14.6621859,14.2799883 15.7004432,15.2811495 C16.886992,16.4676983 17.0826103,17 17.7500305,17 L19.5000305,17 C20.0000305,17 20.2500305,16.75 20.1058094,16.256639 C19.9479883,15.7649264 19.3814752,15.0515168 18.6297655,14.2058271 C18.2218633,13.7237945 17.6100563,13.2046967 17.4246378,12.9450861 C17.1650889,12.6114069 17.2392501,12.4630536 17.4246378,12.1664395 C17.4246378,12.1664395 19.5567654,9.16295598 19.7792491,8.14327764 C19.8904447,7.77247148 19.7792492,7.5 19.2500305,7.5 L17.5000305,7.5 C17.0550631,7.5 16.8499268,7.73537544 16.7386695,7.99492431 C16.7386695,7.99492431 15.8487348,10.1641172 14.5880247,11.5731497 C14.1801534,11.981021 13.9947349,12.1107954 13.7722512,12.1107954 C13.6610248,12.1107954 13.5,11.981021 13.5,11.6102457 L13.5,8.14327764 C13.5,7.69831025 13.3708675,7.5 13.0000305,7.5 L10.2500305,7.5 C9.97196448,7.5 9.80473337,7.70651953 9.80473337,7.90224592 C9.80473337,8.32406685 10.4350575,8.42134367 10.5000305,9.60792336 L10.5000305,12.1849875 C10.5000305,12.75 10.3979923,12.8524386 10.1755087,12.8524386 C9.58224968,12.8524386 8.13914558,10.6735551 7.28325153,8.18034282 C7.11551691,7.69574871 6.94728168,7.5 6.50003052,7.5 Z M90.222,13.189 C86.65,13.189 85.9685,13.847 85.9685,14.9045 C85.9685,15.586 86.65,16.244 87.5665,16.244 C89.1645,16.244 90.222,15.1865 90.222,13.7295 L90.222,13.7295 Z M101.675,9.0765 C99.936,9.0765 98.62,10.3925 98.62,12.39 C98.62,14.3875 99.936,15.7035 101.675,15.7035 C103.3905,15.7035 104.73,14.3875 104.73,12.39 C104.73,10.3925 103.3905,9.0765 101.675,9.0765 Z M115.6425,9.0765 C113.9035,9.0765 112.5875,10.3925 112.5875,12.39 C112.5875,14.3875 113.9035,15.7035 115.6425,15.7035 C117.358,15.7035 118.6975,14.3875 118.6975,12.39 C118.6975,10.3925 117.358,9.0765 115.6425,9.0765 Z M54.2095,1.251 C55.126,1.251 55.925,2.0265 55.925,2.9665 C55.925,3.9065 55.126,4.682 54.2095,4.682 C53.2695,4.682 52.4705,3.9065 52.4705,2.9665 C52.4705,2.0265 53.2695,1.251 54.2095,1.251 Z M73.614,1.251 C74.5305,1.251 75.3295,2.0265 75.3295,2.9665 C75.3295,3.9065 74.5305,4.682 73.614,4.682 C72.674,4.682 71.875,3.9065 71.875,2.9665 C71.875,2.0265 72.674,1.251 73.614,1.251 Z" id="Combined-Shape" fill="url(#linearGradient-1)"></path>
            </g>
        </g>
    </g>
</svg>
  </a>
</div>

<div>
  <h1>VK Bridge
    <a style="margin-left:20px" href="https://npmjs.com/package/@vkontakte/vk-bridge">
      <img src="https://img.shields.io/npm/v/@vkontakte/vk-bridge.svg">
    </a>
  </h1>
</div>

A package for integrating VK Mini Apps with official VK clients for iOS, Android and Web.

## Usage

```js
import bridge from '@vkontakte/vk-bridge';

// Sends event to client
bridge.send('VKWebAppInit');

// Subscribes to event, sended by client
bridge.subscribe(e => console.log(e));
```

For use in a browser, include the file [`dist/index.umd.js`](https://unpkg.com/@vkontakte/vk-bridge/dist/index.umd.js) and use as follows

```html
<script src="dist/index.umd.js"></script>

<script>
  // Sends event to client
  vkBridge.send('VKWebAppInit');
</script>
```

## API Reference

### `bridge.send(method[, params])`

Sends a message to native client and returns the `Promise` object with response data

**Parameters**

- `method` _required_ The VK Bridge method
- `params` _optional_ Message data object

**Example**

```js
// Sending event to client
bridge
  .send('VKWebAppGetEmail')
  .then(data => {
    // Handling received data
    console.log(data.email);
  })
  .catch(error => {
    // Handling an error
  });
```

You can also use imperative way

```js
try {
  const data = await bridge.send('VKWebAppGetEmail');

  // Handling received data
  console.log(data.email);
} catch (error) {
  // Handling an error
}
```

### `bridge.subscribe(fn)`

Subscribes a function to events listening

**Parameters**

- `fn` _required_ Function to be subscribed to events

**Example**

```js
// Subscribing to receiving events
bridge.subscribe(event => {
  if (!event.detail) {
    return;
  }

  const { type, data } = event.detail;

  if (type === 'VKWebAppOpenCodeReaderResult') {
    // Reading result of the Code Reader
    console.log(data.code_data);
  }

  if (type === 'VKWebAppOpenCodeReaderFailed') {
    // Catching the error
    console.log(data.error_type, data.error_data);
  }
});

// Sending method
bridge.send('VKWebAppOpenCodeReader', {});
```

### `bridge.unsubscribe(fn)`

Unsubscribes a function from events listening

**Parameters**

- `fn` _required_ Event subscribed function

**Example**

```js
const fn = event => {
  // ...
};

// Subscribing
bridge.subscribe(fn);

// Unsubscribing
bridge.unsubscribe(fn);
```

### `bridge.supports(method)`

Checks if an event is available on the current device

**Parameters**

- `method` _required_ The VK Bridge method

### `bridge.isWebView()`

Returns `true` if VK Bridge is running in mobile app, or `false` if not

## Middleware API

_Middlewares_ are pieces of code that intercept and process data between sending and receiving. Thus, by creating middlewares, you can easily log data, modify data before sending it, talking to an asynchronous API, etc. If you've used Redux, you were also probably already familiar with the conceptâ€”a similar is used here.

### `applyMiddleware(middleware1, ..., middlewareN)`

Creates the VK Bridge enhancer that applies middleware to the `send`
method. This is handy for a variety of task such as logging every sent
event. Returns the VK Bridge enhancer applying the middleware.

**Parameters**

- `middlewareN` A middleware to be applied

**Example**

```js
import bridge, { applyMiddleware } from '@vkontakte/vk-bridge';

// Logs the result of each sent event
const logger = ({ send, subscribe }) => next => async (method, props) => {
  const result = await next(method, props);
  console.log(result);
  return result;
};

const enhancedBridge = applyMiddleware(logger)(bridge);
```
